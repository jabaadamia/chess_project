{% extends '_base.html' %}

{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'puzzles/css/puzzles_by_tag.css' %}">
<link rel="stylesheet" href="{% static 'css/board.css' %}">
{% endblock %}

{% block content %}
    <a href="{% url 'home' %}">home</a>
    >
    <a href="{% url 'puzzle_home' %}">categories</a>
    <h3>{{ tag }}</h3>
    
    <div id="listbar">
    {% for puzzle in puzzles %}
        {% if puzzle == detail_puzzle %}
            {% if puzzle in user.solved_puzzles.all %}
                <a href="{% url 'tag_puzzle_list' tag puzzle.id %}" style="background-color: #5B7D5A; box-shadow: inset 0 0 0 1px rgb(103, 198, 126);">
                    {{ forloop.counter }}
                </a>
            {% elif puzzle in user.incorrectly_solved_puzzles.all %}
                <a href="{% url 'tag_puzzle_list' tag puzzle.id %}" style="background-color: #994f4f; box-shadow: inset 0 0 0 1px rgb(255, 73, 73);">
                    {{ forloop.counter }}
                </a>
            {% else %}
                <a href="{% url 'tag_puzzle_list' tag puzzle.id %}" style="background-color: #4F4F4F; box-shadow: inset 0 0 0 1px rgb(186, 186, 186);">
                    {{ forloop.counter }}
                </a>
            {% endif %}
        {% else %}
            {% if puzzle in user.solved_puzzles.all %}
                <a href="{% url 'tag_puzzle_list' tag puzzle.id %}" style="background-color: #5B7D5A;">
                    {{ forloop.counter }}
                </a>
            {% elif puzzle in user.incorrectly_solved_puzzles.all %}
                <a href="{% url 'tag_puzzle_list' tag puzzle.id %}" style="background-color: #994f4f;">
                    {{ forloop.counter }}
                </a>
            {% else %}
                <a href="{% url 'tag_puzzle_list' tag puzzle.id %}" style="background-color: #4F4F4F;">
                    {{ forloop.counter }}
                </a>
            {% endif %}
        {% endif %}
    {% endfor %}
    </div>
    
    {% if detail_puzzle %}

    <main id="container">
        <div id="promotion-bar">
            <div class="black-square"></div>
            <div class="white-square"></div>
            <div class="black-square"></div>
            <div class="white-square"></div>
        </div>
        <div>
            <div id="wrapper" onclick="piece_click(event)">
            <div id="18" class="white-square"></div>
            <div id="28" class="black-square"></div>
            <div id="38" class="white-square"></div>
            <div id="48" class="black-square"></div>
            <div id="58" class="white-square"></div>
            <div id="68" class="black-square"></div>
            <div id="78" class="white-square"></div>
            <div id="88" class="black-square"></div>
            <div id="17" class="black-square"></div>
            <div id="27" class="white-square"></div>
            <div id="37" class="black-square"></div>
            <div id="47" class="white-square"></div>
            <div id="57" class="black-square"></div>
            <div id="67" class="white-square"></div>
            <div id="77" class="black-square"></div>
            <div id="87" class="white-square"></div>
            <div id="16" class="white-square"></div>
            <div id="26" class="black-square"></div>
            <div id="36" class="white-square"></div>
            <div id="46" class="black-square"></div>
            <div id="56" class="white-square"></div>
            <div id="66" class="black-square"></div>
            <div id="76" class="white-square"></div>
            <div id="86" class="black-square"></div>
            <div id="15" class="black-square"></div>
            <div id="25" class="white-square"></div>
            <div id="35" class="black-square"></div>
            <div id="45" class="white-square"></div>
            <div id="55" class="black-square"></div>
            <div id="65" class="white-square"></div>
            <div id="75" class="black-square"></div>
            <div id="85" class="white-square"></div>
            <div id="14" class="white-square"></div>
            <div id="24" class="black-square"></div>
            <div id="34" class="white-square"></div>
            <div id="44" class="black-square"></div>
            <div id="54" class="white-square"></div>
            <div id="64" class="black-square"></div>
            <div id="74" class="white-square"></div>
            <div id="84" class="black-square"></div>
            <div id="13" class="black-square"></div>
            <div id="23" class="white-square"></div>
            <div id="33" class="black-square"></div>
            <div id="43" class="white-square"></div>
            <div id="53" class="black-square"></div>
            <div id="63" class="white-square"></div>
            <div id="73" class="black-square"></div>
            <div id="83" class="white-square"></div>
            <div id="12" class="white-square"></div>
            <div id="22" class="black-square"></div>
            <div id="32" class="white-square"></div>
            <div id="42" class="black-square"></div>
            <div id="52" class="white-square"></div>
            <div id="62" class="black-square"></div>
            <div id="72" class="white-square"></div>
            <div id="82" class="black-square"></div>
            <div id="11" class="black-square"></div>
            <div id="21" class="white-square"></div>
            <div id="31" class="black-square"></div>
            <div id="41" class="white-square"></div>
            <div id="51" class="black-square"></div>
            <div id="61" class="white-square"></div>
            <div id="71" class="black-square"></div>
            <div id="81" class="white-square"></div>
        </div>
            <div id="toolbar">
                <div onclick="firstmove()"><img src="{% static 'images/icons/doubleleft.svg' %}" alt=""></div>
                <div onclick="prevmove()"><img src="{% static 'images/icons/left.svg' %}" alt=""></div>
                <div onclick="play()"><img src="{% static 'images/icons/play.svg' %}" alt=""></div>
                <div onclick="nextmove()"><img src="{% static 'images/icons/right.svg' %}" alt=""></div>
                <div onclick="lastmove()"><img src="{% static 'images/icons/doubleright.svg' %}" alt=""></div>
                    
                <div onclick="rotate()"><img src="{% static 'images/icons/rotate.svg' %}" alt=""></div>
            </div>
        </div>
        <div>
            <div id="pgn" onclick="pgn_click(event)"></div>
            <div id="puzzle_data"> 
                <div id="message"></div>
                <div>
                    <p>rating: {{ detail_puzzle.elo_rating}}</p>
                    <a href="{% url 'tag_puzzle_list' tag next_puzzle_id %}">next</a>
                </div>
            </div>
        </div>
    </main>
                    
    {% else %}
        <p>No puzzles found for this tag.</p>
    {% endif %}
    <!-- <form method="post">
        {% csrf_token %}
        <label for="solution">Enter your solution:</label>
        <input type="text" id="solution" name="solution" required>
        <button type="submit">Submit Solution</button>
    </form> -->
    <script>
        let ans = '{{ detail_puzzle.solution }}';
        let start_fen = '{{ detail_puzzle.fen }}';
        const tag = '{{ tag }}';
        const puzzleId = '{{ detail_puzzle.id }}';
        const csrftoken = '{{ csrf_token }}';
    </script>
    <script type="module" src="{% static 'js/puzzle.js' %}"></script>
{% endblock %}